{% extends 'base.html' %}
{% load static %}

{% block title %}Search - Rian's Library{% endblock %}

{% block content %}
<!-- Lottie Animation -->
<div class="lottie-container">
    <lottie-player
        src="{% static 'animations/search.json' %}"
        background="transparent"
        speed="1"
        class="lottie-animation"
        loop
        autoplay>
    </lottie-player>
</div>

<h2>üîç Search Books & Authors</h2>

<!-- Search Form -->
<div class="search-container">
    <form method="GET">
        <input type="text" id="searchInput" name="q" placeholder="Search books or authors..."
               value="{{ query }}" required>
        <button type="submit" id="searchBtn">üîç Search</button>
    </form>
</div>

{% if query %}
    <div style="text-align: center; margin: 2rem 0;">
        <h3>Results for: "{{ query }}"</h3>
        <p style="color: #667eea;">Found {{ books.count }} book{{ books.count|pluralize }} and {{ authors.count }} author{{ authors.count|pluralize }}</p>
    </div>

    <!-- Authors Results -->
    {% if authors %}
        <div style="margin-bottom: 3rem;">
            <h3>üë• Authors</h3>
            <div class="author-grid">
                {% for author in authors %}
                    <div class="author-card" onclick="location.href='{% url 'books:author_books' author.id %}'">
                        <h3>{{ author.name }}</h3>
                        <div class="book-count">
                            üìö {{ author.books.count }} book{{ author.books.count|pluralize }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Books Results -->
    {% if books %}
        <div>
            <h3>üìö Books</h3>
            <div class="book-grid">
                {% for book in books %}
                    <div class="book-card" onclick="location.href='{% url 'books:book_detail' book.id %}'">
                        <h3>{{ book.title|truncatechars:50 }}</h3>
                        <div class="author">
                            üë§ {% for author in book.authors.all %}{{ author.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                        </div>
                        {% if book.publication_year %}
                            <div class="year">üìÖ {{ book.publication_year }}</div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- No Results -->
    {% if not books and not authors %}
        <div class="no-results">
            <h3>üîç No Results Found</h3>
            <p>No books or authors found matching "{{ query }}". Try different search terms.</p>
            <div style="margin-top: 1rem;">
                <a href="{% url 'books:home' %}" class="nav-btn">Browse All Books</a>
                <a href="{% url 'books:authors' %}" class="nav-btn">Browse Authors</a>
            </div>
        </div>
    {% endif %}
{% else %}
    <!-- No Query -->
    <div class="no-results">
        <h3>üîç Start Your Search</h3>
        <p>Enter a book title or author name in the search box above to find what you're looking for.</p>
        <div style="margin-top: 1rem;">
            <a href="{% url 'books:home' %}" class="nav-btn">Browse All Books</a>
            <a href="{% url 'books:authors' %}" class="nav-btn">Browse Authors</a>
        </div>
    </div>
{% endif %}
{% endblock %}
