{% extends 'base.html' %}
{% load static %}

{% block title %}Search Results - Rian's Book Collection{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'books:home' %}">Home</a></li>
        <li class="breadcrumb-item active">Search Results</li>
    </ol>
</nav>

<!-- Search Header -->
<div class="page-header">
    <h1><i class="fas fa-search"></i> Search Results</h1>
    {% if query %}
        <p>Results for: "<strong>{{ query }}</strong>"</p>
    {% else %}
        <p>Enter a search term to find books and authors</p>
    {% endif %}
</div>

<!-- Search Form -->
<div class="search-section">
    <form method="GET" class="search-form">
        <div class="row align-items-end">
            <div class="col-md-8">
                <label for="search-input" class="form-label text-white">Search books and authors:</label>
                <input type="text" id="search-input" class="form-control" name="q" 
                       placeholder="Enter book title or author name..." 
                       value="{{ query }}" required>
            </div>
            <div class="col-md-4">
                <button class="btn btn-light w-100" type="submit">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </div>
    </form>
</div>

{% if query %}
    <!-- Results Summary -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h4>{{ books.count }}</h4>
                    <p class="mb-0">Book{{ books.count|pluralize }} Found</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h4>{{ authors.count }}</h4>
                    <p class="mb-0">Author{{ authors.count|pluralize }} Found</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Authors Results -->
    {% if authors %}
        <div class="mb-5">
            <h3><i class="fas fa-users"></i> Authors</h3>
            <div class="row">
                {% for author in authors %}
                    <div class="col-lg-4 col-md-6 mb-3">
                        <div class="card author-card">
                            <div class="card-body text-center">
                                <div class="mb-2">
                                    <i class="fas fa-user-circle fa-3x"></i>
                                </div>
                                
                                <h6 class="card-title">
                                    <a href="{% url 'books:author_books' author.id %}" class="author-name">
                                        {{ author.name }}
                                    </a>
                                </h6>
                                
                                <p class="card-text small">
                                    <i class="fas fa-book"></i> 
                                    {{ author.books.count }} book{{ author.books.count|pluralize }}
                                </p>
                                
                                <a href="{% url 'books:author_books' author.id %}" class="btn btn-light btn-sm">
                                    View Books
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Books Results -->
    {% if books %}
        <div class="mb-5">
            <h3><i class="fas fa-book"></i> Books</h3>
            <div class="row">
                {% for book in books %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                        <div class="card book-card h-100">
                            <a href="{% url 'books:book_detail' book.id %}">
                                {% if book.cover_image %}
                                    <img src="{{ book.cover_image }}" class="book-cover" alt="{{ book.title }}">
                                {% else %}
                                    <div class="book-cover-placeholder">
                                        <i class="fas fa-book"></i>
                                    </div>
                                {% endif %}
                            </a>
                            
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title">
                                    <a href="{% url 'books:book_detail' book.id %}" class="book-title">
                                        {{ book.title|truncatechars:50 }}
                                    </a>
                                </h6>
                                
                                <div class="book-authors">
                                    <i class="fas fa-user"></i>
                                    {% for author in book.authors.all %}
                                        <a href="{% url 'books:author_books' author.id %}" class="text-decoration-none">
                                            {{ author.name }}
                                        </a>
                                        {% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                                
                                {% if book.publication_year %}
                                    <div class="book-year mt-auto">
                                        <i class="fas fa-calendar"></i> {{ book.publication_year }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- No Results -->
    {% if not books and not authors %}
        <div class="no-results">
            <i class="fas fa-search"></i>
            <h3>No Results Found</h3>
            <p>No books or authors found matching "{{ query }}". Try different search terms.</p>
            <div class="mt-3">
                <a href="{% url 'books:home' %}" class="btn btn-primary me-2">Browse All Books</a>
                <a href="{% url 'books:authors' %}" class="btn btn-outline-primary">Browse Authors</a>
            </div>
        </div>
    {% endif %}
{% else %}
    <!-- No Query -->
    <div class="no-results">
        <i class="fas fa-search"></i>
        <h3>Start Your Search</h3>
        <p>Enter a book title or author name in the search box above to find what you're looking for.</p>
        <div class="mt-3">
            <a href="{% url 'books:home' %}" class="btn btn-primary me-2">Browse All Books</a>
            <a href="{% url 'books:authors' %}" class="btn btn-outline-primary">Browse Authors</a>
        </div>
    </div>
{% endif %}
{% endblock %}
